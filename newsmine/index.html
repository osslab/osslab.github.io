<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="semantic/semantic.min.css">
<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
<script src="semantic/semantic.min.js"></script>
<script language="javascript">
$(document).ready(function() {
/*$('.ui.labeled.icon.sidebar')
  .sidebar('toggle')
;*/

/*
https://semantic-ui.com/modules/sidebar.html#/examples
*/
$('.ui.sidebar')
  .sidebar({
    context: $('.bottom.segment')
  })
  .sidebar('attach events', '.ui.top.attached.menu>.item')
;

});
</script>
</head>
<body>
<div class="ui top attached demo menu">
  <a class="item"><i class="sidebar icon"></i> Newsmine </a>
  
    <div class="left menu">
      <div class="item">
        <div class="ui icon input">
          <input type="text" placeholder="Search...">
          <i class="search link icon"></i>
        </div>
      </div>
    </div>
    <div class="right menu">
      <a class="ui item">Logout </a>
    </div>

  

</div>
<div class="ui bottom attached segment pushable">
  <div class="ui inverted labeled icon left inline vertical sidebar menu">
    <a class="item"><i class="home icon"></i> Home </a>
    <a class="item"><i class="block layout icon"></i> Topics </a>
    <a class="item"><i class="smile icon"></i> Friends </a>
    <a class="item"><i class="calendar icon"></i> History </a>
  </div>
  <div class="pusher">

    <div class="ui main container" style="margin-top:3em;margin-bottom:3em">
    
      
  

      <div class="ui three column doubling stackable grid">
        <div class="ui active dimmer">
          <div class="ui massive text loader">Loading</div>
        </div>
  <!--div class="column">
    <div class="ui fluid card">
      <div class="content">
        <a class="header">Daniel Louise</a>
      </div>
    </div>
  </div>
  <div class="column">
    <div class="ui fluid card">
      <div class="content">
        <a class="header">Helen Troy</a>
      </div>
    </div>
  </div>
  <div class="column">
    <div class="ui fluid card">
      <div class="content">
        <a class="header">Elliot Fu</a>
      </div>
    </div>    
  </div>
  <div class="column">
    <div class="ui fluid card">
      <div class="content">
        <a class="header">Daniel Louise</a>
      </div>
    </div>
  </div>
  <div class="column">
    <div class="ui fluid card">
      <div class="content">
        <a class="header">Helen Troy</a>
      </div>
    </div>
  </div>
  <div class="column">
    <div class="ui fluid card">
      <div class="content">
        <a class="header">Elliot Fu</a>
      </div>
    </div>  
</div-->
        <!--div class="ui relaxed divided items"-->
          <!--div class="item">
            <div class="ui small image">
              <img src="assets/images/wireframe/image.png">
            </div>
            <div class="content">
              <a class="header">Content Header</a>
              <div class="meta">
                <a>Date</a>
                <a>Category</a>
              </div>
              <div class="description">
                A description which may flow for several lines and give context to the content.
              </div>
              <div class="extra">
                <img src="assets/images/wireframe/square-image.png" class="ui circular avatar image"> Username
              </div>
            </div>
          </div>
          <div class="item">
            <div class="ui small image">
              <img src="assets/images/wireframe/image.png">
            </div>
            <div class="content">
              <a class="header">Content Header</a>
              <div class="meta">
                <a>Date</a>
                <a>Category</a>
              </div>
              <div class="description">
                A description which may flow for several lines and give context to the content.
              </div>
              <div class="extra">
                <div class="ui right floated primary button">
                  Primary
                  <i class="right chevron icon"></i>
                </div>
                <div class="ui label">Limited</div>
              </div>
            </div>
          </div>
          <div class="item">
            <div class="ui small image">
              <img src="assets/images/wireframe/image.png">
            </div>
            <div class="content">
              <a class="header">Content Header</a>
              <div class="meta">
                <a>Date</a>
                <a>Category</a>
              </div>
              <div class="description">
                A description which may flow for several lines and give context to the content.
              </div>
              <div class="extra">
                <div class="ui right floated primary button">
                  Primary
                  <i class="right chevron icon"></i>
                </div>
              </div>
            </div>
          </div-->
        <!--/div-->

    </div>

  </div>
</div>




<div class="ui inverted vertical footer segment">
    <div class="ui center aligned container">
      <div class="ui stackable inverted divided grid">
        <div class="three wide column">
          <h4 class="ui inverted header">Group 1</h4>
          <div class="ui inverted link list">
            <a href="#" class="item">Link One</a>
            <a href="#" class="item">Link Two</a>
            <a href="#" class="item">Link Three</a>
            <a href="#" class="item">Link Four</a>
          </div>
        </div>
        <div class="three wide column">
          <h4 class="ui inverted header">Group 2</h4>
          <div class="ui inverted link list">
            <a href="#" class="item">Link One</a>
            <a href="#" class="item">Link Two</a>
            <a href="#" class="item">Link Three</a>
            <a href="#" class="item">Link Four</a>
          </div>
        </div>
        <div class="three wide column">
          <h4 class="ui inverted header">Group 3</h4>
          <div class="ui inverted link list">
            <a href="#" class="item">Link One</a>
            <a href="#" class="item">Link Two</a>
            <a href="#" class="item">Link Three</a>
            <a href="#" class="item">Link Four</a>
          </div>
        </div>
        <div class="seven wide column">
          <h4 class="ui inverted header">Footer Header</h4>
          <p>Extra space for a call to action inside the footer that could help re-engage users.</p>
        </div>
      </div>
      <div class="ui inverted section divider"></div>
      <img src="assets/images/logo.png" class="ui centered mini image">
      <div class="ui horizontal inverted small divided link list">
        <a class="item" href="#">Site Map</a>
        <a class="item" href="#">Contact Us</a>
        <a class="item" href="#">Terms and Conditions</a>
        <a class="item" href="#">Privacy Policy</a>
      </div>
    </div>
  </div>
      <script>
          
    $(document).ready(function() {
      
      //window.sr = ScrollReveal();
      //sr.reveal('.fooContainer .fooReveal', { reset: true, viewOffset: { top: 64 } });    
        var today = new Date();
        
        var jobHour = today.getHours();


        if (jobHour < 6){
          today.setDate(today.getDate() - 1);
        }

        var year = today.getFullYear();
        var month = today.getMonth() + 1;
        var date = today.getDate();


        var new_month = month.toString();
        var new_date = date.toString();
        if (new_month.length == 1) new_month = "0" + month.toString();
        if (new_date.length == 1) new_date = "0"+ date.toString();


        console.log(jobHour);
        console.log(date);
        console.log("http://35.187.214.148:8000/front-beta?where={%22date.0%22:%22"+year+"%22,%22date.1%22:%22"+month+"%22,%22date.2%22:%22"+date+"%22}&sort=[(%22shares.0%22,%20-1)]&max_results=13"); 
        $.ajax({
            type: "GET",
            //url: "top50.tsv",
            //dataType: "text",
            beforeSend:function(){
              $('.ui.active.dimmer').show();
            },
            complete:function(){
              $('.ui.active.dimmer').hide();
            },            
            contentType: "application/json; charset=utf-8",
            url : "http://35.187.214.148:8000/front-beta?where={%22date.0%22:%22"+year+"%22,%22date.1%22:%22"+new_month+"%22,%22date.2%22:%22"+new_date+"%22}&sort=[(%22shares.0%22,%20-1)]&max_results=13",
            dataType:"json",
            success: function(data) {processData(data);}
         });

        
    });

    function processData(allText) {

      //var json = $.parseJSON(allText);
      console.log(allText._items);  
      
      //var allTextLines = allText.split(/\r\n|\n/);
      var allTextLines = allText._items;
      //var headers = allTextLines[0].split('\t');
      var lines = [];


      var items= $("<div>");
      items.attr({
            "class": "ui three column doubling stackable grid"
      })      
      for (var i=1; i<allTextLines.length; i++) {
          
          
          
          var column = $('<div>');
          column.attr({
              "class":"column"
          });                        
          
          var card = $('<div>');
          card.attr({
            "class":"ui fluid card"

          });

          var content = $('<div>');
          content.attr({
              "class":"content"
          });
          var data = allTextLines[i];
          //console.log(data)
          //console.log()
          var ahref = $('<a>');
          ahref.attr({
            "class":"header"
          });
          ahref.attr('href',data['org_url']);
          ahref.attr('target', '_blank');
          ahref.html(data['title']);
          //if (data[6] != "none"){
            /*
            var image = $("<img>");
            //if (data.length == headers.length) {
                var image = $("<img>");
                //var width = getRandomSize(200, 400);
                //var height =  getRandomSize(200, 400);
                image.attr({
                  //http://imgnews.naver.net/image/origin/437/2016/05/17/118799.jpg
                  "src": "http://imgnews.naver.net/image/origin/" + data['naver'][0] + "/" + data['date'].join('/') + "/" + data['naver'][1].slice(3) + ".jpg",
                  "width" : "150px",
                  "height" : "150px"
                });
                
            //}*/

            //var img_div = $('<div class="ui small image">');
            /*var span = $('<span>');
            span.html(data[1]);
            h4.append(span);
            */
            //img_div.append(image);
            //h5.html(data['title']);
            //ahref.append(image);
            //ahref.append(h5);
            var extra = $("<div class='extra content'>");
            extra.html("<span class='right floated'><a><i class='share icon'></i> " + addCommas(data["shares"][0]) + " Shared</a></span>");

            content.append(ahref);

            card.append(content);
            card.append(extra);
            column.append(card);
            items.append(column);
          //}
          //else {
            /*var div = $('<div>');
            var width = getRandomSize(200, 400);
            var height =  getRandomSize(200, 400);

            div.css({
              "display": "table-cell",
              "text-align": "center",
              "vertical-align": "middle",
              "width" : width,
              "height" : height,
              "line-height": height

            });
            
            var span = $('<span>');
            span.html(data[1]);
            h4.append(span);
            
            
            ahref.html(data[1]);
            div.append(ahref);
            content.append(div);*/
          //}
          
          
        
          //if(i%3==0) $('#first').append(content);
          //if(i%3==1) $('#second').append(content);
          //if(i%3==2) $('#third').append(content);

           

      }
      $('.ui.main.container').append(items);
      //console.log($('div#first>div.fooReveal').size());
      //console.log($('div#second>div.fooReveal').size());
      //console.log($('div#third>div.fooReveal').size());
      /*
      for (var i = 0; i < content.length; i++) {
        fooContainer.appendChild(content[ i ]);
      };
        console.log(lines)

      */

      
    }

function addCommas(nStr)
{
    nStr += '';
    x = nStr.split('.');
    x1 = x[0];
    x2 = x.length > 1 ? '.' + x[1] : '';
    var rgx = /(\d+)(\d{3})/;
    while (rgx.test(x1)) {
        x1 = x1.replace(rgx, '$1' + ',' + '$2');
    }
    return x1 + x2;
}    
</script>
</body>
</html>

