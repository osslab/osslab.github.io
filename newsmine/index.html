<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<link rel="stylesheet" type="text/css" href="semantic/semantic.min.css">
<link rel="stylesheet" type="text/css" href="css/logo.css">
<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
<script src="semantic/semantic.min.js"></script>
<script language="javascript">

$(document).ready(function() {
/*$('.ui.labeled.icon.sidebar')
  .sidebar('toggle')
;*/

/*
https://semantic-ui.com/modules/sidebar.html#/examples
*/


$('.ui.sidebar')
  .sidebar({
    context: $('.bottom.segment')
  })
  .sidebar('attach events', '.ui.fixed.menu>.item')
;

$('.ui.search')
  .search({
    apiSettings: {
      //url: 'http://35.187.214.148:8983/solr/dbnews/terms?terms.fl=title&terms.prefix={query}'
      //url:'http://35.187.214.148:8983/solr/dbnews/select?wt=json&q=title:%22({query})%22~100&sort=datetime%20desc,o_shares%20desc,n_shares%20desc',
      url:'http://35.187.214.148:5000/api/search?q={query}',
      beforeSend:function(settings){
        $('.ui.active.dimmer').show();
        return settings;
      },
      onResponse:function(solrResult){
        //console.log(solrResult["response"]);
        $('.ui.active.dimmer').hide();
        //solrResult["response"].docs;
        //return 
        var
          response = {
            results : []
          }
        ;

        var maxResults = 12
        $.each(solrResult["response"].docs, function(index, item) {

          if(index >= maxResults) {
            return false;
          }
          
          var o_shares = isNaN(item['o_shares']) ? 0 : item['o_shares'];
          var n_shares = isNaN(item['n_shares']) ? 0 : item['n_shares'];
          var query = item['naver_url'].split('?')[1];
          var params = query.split('&');          


          response.results.push({
            title       : item.title,
            org_url     : item.org_url,
            shares      : [o_shares+n_shares,o_shares,n_shares],
            naver       : [params[2].split('=')[1], params[3].split('=')[1]]
          });

        });
        //console.log(response);
        return response;
      },

    },

    onResults: function(respose){
      //console.log(response);

    },
    onResultsAdd :function(html){
      /*
      var results = $('.results');
      results.append(html);
      //$('.results').append(html);
      $("a.result").attr("target","_blank");
      results.addClass("transition visible");
      results.css({"display":"block !important;"});
      return false;
      */
      $('.ui.main.container').empty();
      $('.ui.main.container').append(html);
      return false;
    },
    onSearchQuery:function (query){
      //var results = $('.results');
      //results.addClass("transition hidden");
      //results.empty();
      console.log(query);
    },
    onSelect :function(result, response){
         
        //
        //alert(result ? result.title : 'null');
        

    },         
    minCharacters : 2,
    maxResults : 12,
    type: 'customType',
    templates : {
      customType : function(response){
        
        console.log(response.results);  
        var results = response.results;

        /*
        results.forEach(function(row){
          var o_shares = isNaN(row['o_shares']) ? 0 : row['o_shares'];
          var n_shares = isNaN(row['n_shares']) ? 0 : row['n_shares'];
          row['shares']=[ o_shares+n_shares,o_shares,n_shares];
          

          //console.log(params[2].split('=')[1]);
          //console.log(params[3].split('=')[1]);
          row['naver']=[params[2].split('=')[1], params[3].split('=')[1]]


        });*/
        //console.log(results);
        //var html = "";
        var items_html = processData(results);
        //$('.ui.main.container').append(items_html);
        return items_html;
      }
    }


  })
;

});


</script>
</head>
<body>
<div class="ui top huge  fixed menu">
  <a class="item"><i class="sidebar icon"></i> Newsmine </a>
  
    <!--div class="left menu">

    </div-->
    <div class="right menu">
      <div class="ui search item">
        <div class="ui left icon input">
          <input class="prompt" type="text" placeholder="Search ...">
          <i class="search icon"></i>
        </div>
      </div>    
      <div class="item">
                <div class="fb-messengermessageus" 
                  messenger_app_id="1079304098830180" 
                  page_id="1789360957950088"
                  color="blue"
                  size="large" >
                </div>
      </div>

    </div>

  

</div>
<div class="ui bottom attached segment pushable" style="margin-top:3em;margin-bottom:0;">
  <div class="ui inverted labeled icon left inline vertical sidebar menu">
    <a class="item"><i class="home icon"></i> Home </a>
    <a class="item"><i class="block layout icon"></i> Topics </a>
    <a class="item"><i class="smile icon"></i> Friends </a>
    <a class="item"><i class="calendar icon"></i> History </a>
  </div>
  <div class="pusher">
    <div class="ui main container" style="margin-top:3em;margin-bottom:3em;"  id="example1">
      <div class="ui container">
        <div class="ui active dimmer">
          <div class="ui massive text loader">Loading</div>
        </div>
      </div>
  
    </div>
  </div>
</div>
<div class="ui inverted vertical footer segment">
  <div class="ui center aligned container">
    <div class="ui horizontal inverted small divided link list">
      <a class="item" href="#">Site Map</a>
      <a class="item" href="#">Contact Us</a>
      <a class="item" href="#">Terms and Conditions</a>
      <a class="item" href="#">Privacy Policy</a>
    </div>
  </div>
</div>
<script>
          
    $(document).ready(function() {
      
      //window.sr = ScrollReveal();
      //sr.reveal('.fooContainer .fooReveal', { reset: true, viewOffset: { top: 64 } });    
        var today = new Date();
        
        var jobHour = today.getHours();


        if (jobHour < 7){
          today.setDate(today.getDate() - 1);
        }

        var year = today.getFullYear();
        var month = today.getMonth() + 1;
        var date = today.getDate();


        var new_month = month.toString();
        var new_date = date.toString();
        if (new_month.length == 1) new_month = "0" + month.toString();
        if (new_date.length == 1) new_date = "0"+ date.toString();


        console.log(jobHour);
        console.log(date);
        
        $.ajax({
            type: "GET",
            crossDomain: true,
      
            //url: "top50.tsv",
            //dataType: "text",
            beforeSend:function(){
              $('.ui.active.dimmer').show();
            },
            complete:function(){
              $('.ui.active.dimmer').hide();
            },            
            contentType: "application/json; charset=utf-8",
            url : "http://35.187.214.148:8000/front-beta?where={%22date.0%22:%22"+year+"%22,%22date.1%22:%22"+new_month+"%22,%22date.2%22:%22"+new_date+"%22}&sort=[(%22shares.0%22,%20-1)]&max_results=12",
            dataType:"json",
            success: function(data) {
              var items_html = processData(data._items);
              $('.ui.main.container').append(items_html);
            }
         });

        
    });

    function processData(datarows) {

      //var json = $.parseJSON(allText);
      //console.log(datarows);  
      
      //var allTextLines = allText.split(/\r\n|\n/);
      //var allTextLines = allText._items;
      //var headers = allTextLines[0].split('\t');
      var lines = [];


      var items= $('<div>');
      items.attr({
           "class": "ui three column stackable grid"
      })      
      for (var i=0; i<datarows.length; i++) {
          
          var column = $('<div>');
          column.attr({
              "class":"column"
          });                        
          
          var segment = $('<div class="ui segment">');


          var card = $('<div>');
          card.attr({
            "class":"ui fluid card"

          });

          var content = $('<div>');
          content.attr({
              "class":"content"
          });
          var data = datarows[i];
          //console.log(data)
          //console.log()
          var ahref = $('<a>');
          ahref.attr({
            "class":"header"
          });
          ahref.attr('href',data['org_url']);
          ahref.attr('target', '_blank');
          ahref.html(data['title']);

            var extra = $("<div class='extra content'>");
            extra.html("<span class='press_" + data["naver"][0] + " left floated'></span><span class='right floated'><a><i class='share icon'></i> " + addCommas(data["shares"][0]) + " Shared</a></span>");

            content.append(ahref);

            card.append(content);
            card.append(extra);
            //segment.append(card)
            column.append(card);

            items.append(column);

      }
      return items;
      
    }

  function addCommas(nStr)
  {
      nStr += '';
      x = nStr.split('.');
      x1 = x[0];
      x2 = x.length > 1 ? '.' + x[1] : '';
      var rgx = /(\d+)(\d{3})/;
      while (rgx.test(x1)) {
          x1 = x1.replace(rgx, '$1' + ',' + '$2');
      }
      return x1 + x2;
  }    

</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-43044462-4', 'auto');
      ga('send', 'pageview');

    </script>  
    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId: "1079304098830180",
          xfbml: true,
          version: "v2.6"
        });

      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) { return; }
         js = d.createElement(s); js.id = id;
         js.src = "//connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));

    </script>
</body>
</html>

