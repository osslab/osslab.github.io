<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="semantic/semantic.min.css">
<link rel="stylesheet" type="text/css" href="css/logo.css">
<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
<script src="semantic/semantic.min.js"></script>
<script language="javascript">

$(document).ready(function() {
/*$('.ui.labeled.icon.sidebar')
  .sidebar('toggle')
;*/

/*
https://semantic-ui.com/modules/sidebar.html#/examples
*/
$('.ui.sidebar')
  .sidebar({
    context: $('.bottom.segment')
  })
  .sidebar('attach events', '.ui.fixed.menu>.item')
;

});


</script>
</head>
<body>
<div class="ui top fixed menu">
  <a class="item"><i class="sidebar icon"></i> Newsmine </a>
  
    <div class="left menu">
      <div class="item">
        <div class="ui icon input">
          <input type="text" placeholder="Search...">
          <i class="search link icon"></i>
        </div>
      </div>
    </div>
    <div class="right menu">
      <div class="item">
                <div class="fb-messengermessageus" 
                  messenger_app_id="1079304098830180" 
                  page_id="1789360957950088"
                  color="blue"
                  size="large" >
                </div>
      </div>

    </div>

  

</div>
<div class="ui bottom attached segment pushable" style="margin-top:3em;margin-bottom:3em;">
  <div class="ui inverted labeled icon left inline vertical sidebar menu">
    <a class="item"><i class="home icon"></i> Home </a>
    <a class="item"><i class="block layout icon"></i> Topics </a>
    <a class="item"><i class="smile icon"></i> Friends </a>
    <a class="item"><i class="calendar icon"></i> History </a>
  </div>
  <div class="pusher">

    <div class="ui main container" style="margin-top:3em;margin-bottom:3em;">
    
      
  

      <div class="ui three column doubling stackable grid">
        <div class="ui active dimmer">
          <div class="ui massive text loader">Loading</div>
        </div>
  
    </div>

  </div>
</div>




  <div class="ui inverted vertical footer segment">
    <div class="ui center aligned container">
      <div class="ui horizontal inverted small divided link list">
        <a class="item" href="#">Site Map</a>
        <a class="item" href="#">Contact Us</a>
        <a class="item" href="#">Terms and Conditions</a>
        <a class="item" href="#">Privacy Policy</a>
      </div>
    </div>
  </div>
      <script>
          
    $(document).ready(function() {
      
      //window.sr = ScrollReveal();
      //sr.reveal('.fooContainer .fooReveal', { reset: true, viewOffset: { top: 64 } });    
        var today = new Date();
        
        var jobHour = today.getHours();


        if (jobHour < 6){
          today.setDate(today.getDate() - 1);
        }

        var year = today.getFullYear();
        var month = today.getMonth() + 1;
        var date = today.getDate();


        var new_month = month.toString();
        var new_date = date.toString();
        if (new_month.length == 1) new_month = "0" + month.toString();
        if (new_date.length == 1) new_date = "0"+ date.toString();


        console.log(jobHour);
        console.log(date);
        
        $.ajax({
            type: "GET",
            //url: "top50.tsv",
            //dataType: "text",
            beforeSend:function(){
              $('.ui.active.dimmer').show();
            },
            complete:function(){
              $('.ui.active.dimmer').hide();
            },            
            contentType: "application/json; charset=utf-8",
            url : "http://35.187.214.148:8000/front-beta?where={%22date.0%22:%22"+year+"%22,%22date.1%22:%22"+new_month+"%22,%22date.2%22:%22"+new_date+"%22}&sort=[(%22shares.0%22,%20-1)]&max_results=12",
            dataType:"json",
            success: function(data) {processData(data);}
         });

        
    });

    function processData(allText) {

      //var json = $.parseJSON(allText);
      console.log(allText._items);  
      
      //var allTextLines = allText.split(/\r\n|\n/);
      var allTextLines = allText._items;
      //var headers = allTextLines[0].split('\t');
      var lines = [];


      var items= $("<div>");
      items.attr({
            "class": "ui three column stackable grid"
      })      
      for (var i=0; i<allTextLines.length; i++) {
          
          
          
          var column = $('<div>');
          column.attr({
              "class":"column"
          });                        
          
          var card = $('<div>');
          card.attr({
            "class":"ui fluid card"

          });

          var content = $('<div>');
          content.attr({
              "class":"content"
          });
          var data = allTextLines[i];
          //console.log(data)
          //console.log()
          var ahref = $('<a>');
          ahref.attr({
            "class":"header"
          });
          ahref.attr('href',data['org_url']);
          ahref.attr('target', '_blank');
          ahref.html(data['title']);

            var extra = $("<div class='extra content'>");
            extra.html("<span class='press_" + data["naver"][0] + " left floated'></span><span class='right floated'><a><i class='share icon'></i> " + addCommas(data["shares"][0]) + " Shared</a></span>");

            content.append(ahref);

            card.append(content);
            card.append(extra);
            column.append(card);
            items.append(column);

      }
      $('.ui.main.container').append(items);
      
    }

  function addCommas(nStr)
  {
      nStr += '';
      x = nStr.split('.');
      x1 = x[0];
      x2 = x.length > 1 ? '.' + x[1] : '';
      var rgx = /(\d+)(\d{3})/;
      while (rgx.test(x1)) {
          x1 = x1.replace(rgx, '$1' + ',' + '$2');
      }
      return x1 + x2;
  }    

</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-43044462-4', 'auto');
      ga('send', 'pageview');

    </script>  
    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId: "1079304098830180",
          xfbml: true,
          version: "v2.6"
        });

      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) { return; }
         js = d.createElement(s); js.id = id;
         js.src = "//connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));

    </script>
</body>
</html>

